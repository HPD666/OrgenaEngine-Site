<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orgena Studio - 3D Editor</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: white;
            display: flex;
            height: 100vh;
        }

        /* Sidebar Style */
        #sidebar {
            width: 320px;
            background-color: #222;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            overflow-y: auto;
        }

        #sidebar button,
        #sidebar select,
        #sidebar input,
        #sidebar textarea {
            background: #333;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-size: 1rem;
            width: 100%;
            outline: none;
        }

        #sidebar button:hover {
            background-color: #555;
            cursor: pointer;
        }

        label {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        #objectList {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            height: 120px;
            border: 1px solid #444;
            border-radius: 4px;
        }

        #objectList li {
            padding: 8px;
            border-bottom: 1px solid #444;
            cursor: pointer;
            font-size: 0.9rem;
        }

        #objectList li.selected {
            background-color: #555;
        }

        #viewport {
            flex-grow: 1;
            background-color: #121212;
            position: relative;
        }

        /* Dark/Light Mode Toggle */
        body.light-mode {
            background-color: #fff;
            color: #000;
        }

        body.light-mode #sidebar {
            background-color: #f5f5f5;
        }

        body.light-mode #sidebar button,
        body.light-mode #sidebar input,
        body.light-mode #sidebar select,
        body.light-mode #sidebar textarea {
            background-color: #fff;
            color: #000;
        }

        body.light-mode #objectList li {
            color: #000;
        }

        body.light-mode #objectList li.selected {
            background-color: #888;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <!-- Add Object Controls -->
        <button id="btnAddObject">Add Object</button>
        <select id="primitiveType">
            <option value="cube">Cube</option>
            <option value="sphere">Sphere</option>
            <option value="cylinder">Cylinder</option>
            <option value="plane">Plane</option>
        </select>

        <ul id="objectList"></ul>

        <!-- Object Properties Panel -->
        <label for="propName">Object Name</label>
        <input id="propName" type="text">

        <label for="propPosition">Position (x, y, z)</label>
        <input id="propPosition" type="text" placeholder="0, 0, 0">

        <label for="propRotation">Rotation (deg x, y, z)</label>
        <input id="propRotation" type="text" placeholder="0, 0, 0">

        <label for="propScale">Scale (x, y, z)</label>
        <input id="propScale" type="text" placeholder="1, 1, 1">

        <label for="propColor">Color</label>
        <input id="propColor" type="color">

        <label for="propScript">Script</label>
        <textarea id="propScript" placeholder="e.g. obj.rotation.y += 0.01;"></textarea>

        <button id="btnUpdateProperties">Update Properties</button>
        <button id="btnSaveProject">Save Project</button>
        <button id="btnLoadProject">Load Project</button>
        <button id="btnToggleMode">Toggle Dark/Light Mode</button>
    </div>

    <div id="viewport"></div>

    <!-- Three.js and controls -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/TransformControls.min.js"></script>

    <script>
        (() => {
            // Initial Setup
            const container = document.getElementById('viewport');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(5, 5, 10);

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            // Lighting
            const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.8);
            scene.add(hemiLight);

            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            scene.add(dirLight);

            // Controls
            const orbitControls = new THREE.OrbitControls(camera, renderer.domElement);
            orbitControls.enableDamping = true;

            const transformControls = new THREE.TransformControls(camera, renderer.domElement);
            scene.add(transformControls);

            // Data
            const objects = [];
            let selectedObject = null;

            // UI Elements
            const btnAddObject = document.getElementById('btnAddObject');
            const primitiveType = document.getElementById('primitiveType');
            const objectList = document.getElementById('objectList');
            const btnUpdateProperties = document.getElementById('btnUpdateProperties');
            const btnSaveProject = document.getElementById('btnSaveProject');
            const btnLoadProject = document.getElementById('btnLoadProject');
            const btnToggleMode = document.getElementById('btnToggleMode');

            const propName = document.getElementById('propName');
            const propPosition = document.getElementById('propPosition');
            const propRotation = document.getElementById('propRotation');
            const propScale = document.getElementById('propScale');
            const propColor = document.getElementById('propColor');
            const propScript = document.getElementById('propScript');

            // Helpers
            function createPrimitive(type) {
                let geometry;
                switch (type) {
                    case 'cube': geometry = new THREE.BoxGeometry(1, 1, 1); break;
                    case 'sphere': geometry = new THREE.SphereGeometry(0.5, 32, 32); break;
                    case 'cylinder': geometry = new THREE.CylinderGeometry(0.5, 0.5, 1, 32); break;
                    case 'plane': geometry = new THREE.PlaneGeometry(1, 1); break;
                    default: geometry = new THREE.BoxGeometry(1, 1, 1);
                }
                const material = new THREE.MeshStandardMaterial({ color: 0x156289 });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.name = `${type[0].toUpperCase() + type.slice(1)} ${objects.length + 1}`;
                return mesh;
            }

            function updateObjectList() {
                objectList.innerHTML = '';
                objects.forEach((obj) => {
                    const li = document.createElement('li');
                    li.textContent = obj.name;
                    li.classList.toggle('selected', obj === selectedObject);
                    li.addEventListener('click', () => selectObject(obj));
                    objectList.appendChild(li);
                });
            }

            function selectObject(obj) {
                if (selectedObject === obj) return;
                selectedObject = obj;
                transformControls.attach(obj);
                updateObjectList();
                loadProperties(obj);
            }

            function loadProperties(obj) {
                propName.value = obj.name;
                propPosition.value = `${obj.position.x.toFixed(1)}, ${obj.position.y.toFixed(1)}, ${obj.position.z.toFixed(1)}`;
                propRotation.value = `${THREE.MathUtils.radToDeg(obj.rotation.x).toFixed(1)}, ${THREE.MathUtils.radToDeg(obj.rotation.y).toFixed(1)}, ${THREE.MathUtils.radToDeg(obj.rotation.z).toFixed(1)}`;
                propScale.value = `${obj.scale.x.toFixed(1)}, ${obj.scale.y.toFixed(1)}, ${obj.scale.z.toFixed(1)}`;
                propColor.value = `#${obj.material.color.getHexString()}`;
                propScript.value = obj.userData.script || '';
            }

            function clearProperties() {
                propName.value = '';
                propPosition.value = '';
                propRotation.value = '';
                propScale.value = '';
                propColor.value = '#156289';
                propScript.value = '';
            }

            // Event Listeners
            btnAddObject.addEventListener('click', () => {
                const newObject = createPrimitive(primitiveType.value);
                scene.add(newObject);
                objects.push(newObject);
                updateObjectList();
            });

            btnUpdateProperties.addEventListener('click', () => {
                if (!selectedObject) return;
                selectedObject.name = propName.value;
                const [x, y, z] = propPosition.value.split(',').map(Number);
                selectedObject.position.set(x, y, z);
                const [rx, ry, rz] = propRotation.value.split(',').map(Number);
                selectedObject.rotation.set(THREE.MathUtils.degToRad(rx), THREE.MathUtils.degToRad(ry), THREE.MathUtils.degToRad(rz));
                const [sx, sy, sz] = propScale.value.split(',').map(Number);
                selectedObject.scale.set(sx, sy, sz);
                selectedObject.material.color.set(propColor.value);
                selectedObject.userData.script = propScript.value;
            });

            btnSaveProject.addEventListener('click', () => {
                localStorage.setItem('orgena_project', JSON.stringify(objects.map((obj) => ({
                    name: obj.name,
                    type: obj.geometry.type,
                    position: obj.position.toArray(),
                    rotation: obj.rotation.toArray(),
                    scale: obj.scale.toArray(),
                    color: obj.material.color.getHexString(),
                    script: obj.userData.script
                }))));
                alert('Project saved!');
            });

            btnLoadProject.addEventListener('click', () => {
                const savedProject = JSON.parse(localStorage.getItem('orgena_project'));
                if (savedProject) {
                    objects.length = 0;
                    scene.clear();
                    savedProject.forEach((data) => {
                        const mesh = createPrimitive(data.type.toLowerCase());
                        mesh.name = data.name;
                        mesh.position.set(...data.position);
                        mesh.rotation.set(...data.rotation);
                        mesh.scale.set(...data.scale);
                        mesh.material.color.set(`#${data.color}`);
                        mesh.userData.script = data.script;
                        scene.add(mesh);
                        objects.push(mesh);
                    });
                    updateObjectList();
                } else {
                    alert('No project found!');
                }
            });

            // Dark/Light Mode Toggle
            btnToggleMode.addEventListener('click', () => {
                document.body.classList.toggle('light-mode');
            });

            // Resize Handling
            window.addEventListener('resize', () => {
                renderer.setSize(container.clientWidth, container.clientHeight);
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
            });

            // Main Loop
            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
                orbitControls.update();
            }

            animate();
        })();
    </script>
</body>
</html>
